function toggleMenuActive(anchor){var li=anchor.parents("li:first"),ul=li.parents("ul:first"),isDropdown=li.filter("[class*='dropdown']").length>0||ul.filter("[class*='dropdown']").length>0;if(isDropdown){var root_li=ul.parents("li:first"),root_ul=root_li.parents("ul:first");li.hasClass("dropdown")||root_li.hasClass("active")||(root_ul.find("li.active").removeClass("active"),root_li.addClass("active"))}else li.hasClass("active")||(ul.find("li.active").removeClass("active"),li.addClass("active"))}var app=angular.module("app",["ngRoute","xeditable","ui.bootstrap","pascalprecht.translate"]),httpHeaders,originalLocation="/main";app.config(function($routeProvider,$httpProvider,$translateProvider){$routeProvider.when("/main",{templateUrl:"partials/main.html"}).when("/student/search",{controller:"StudentController",templateUrl:"partials/student_search.html"}).when("/student/save",{controller:"StudentController",templateUrl:"partials/student_save.html"}).when("/login",{controller:"LoginController",templateUrl:"partials/login.html"}).otherwise({redirectTo:"/main"}),$translateProvider.useStaticFilesLoader({prefix:"resources/i18n/",suffix:".json"}),$translateProvider.preferredLanguage("en"),$httpProvider.interceptors.push("myHttpResponseInterceptor"),httpHeaders=$httpProvider.defaults.headers}),app.controller("MainController",function($scope,$rootScope,$location,AuthenticationService){$scope.logout=function(){$scope.$emit("event:logoutRequest"),AuthenticationService.logout().then(function(){$rootScope.user=null,$scope.username=$scope.password=null,$location.path("/main")})}}),app.controller("StudentController",function($scope,StudentService){$scope.init=function(){StudentService.getStudents().then(function(response){$scope.students=response})},$scope["delete"]=function(id){StudentService.deleteStudent(id).then(function(){angular.forEach($scope.students,function(student,index){id==student.studentId&&($scope.students.splice(index,1),console.info("Student "+id+" has been deleted."))})})},$scope.save=function(id){angular.forEach($scope.students,function(student){id==student.studentId&&StudentService.saveStudent(student).then(function(){console.info("Student "+id+" has been saved.")})})},$scope.saveStudent=function(){student={studentName:$scope.studentName,birthday:$scope.birthday},StudentService.saveStudent(student).then(function(){console.info("Student "+$scope.studentName+" has been saved."),window.location="#/student/search"})}}),app.controller("LoginController",function($scope,$location){$scope.login=function(){$scope.$emit("event:loginRequest",$scope.username,$scope.password),$location.path(originalLocation)}}),app.factory("myHttpResponseInterceptor",function($q,$location,$rootScope){return{response:function(response){return response},responseError:function(rejection){if(401===rejection.status){var deferred=$q.defer(),req={config:rejection.config,deferred:deferred};return $rootScope.requests401.push(req),$rootScope.$broadcast("event:loginRequired"),deferred.promise}return $q.reject(response)}}}),app.run(function($rootScope,$http,$location,Base64Service,editableOptions){editableOptions.theme="bs3",$rootScope.$on("$routeChangeStart",function(){$http.get("user/authenticated/retrieve").success(function(data){$rootScope.user=data})}),$rootScope.requests401=[],$rootScope.$on("event:loginRequired",function(){$rootScope.requests401=[],-1==$location.path().indexOf("/login")&&(originalLocation=$location.path(),$rootScope.error="Please enter a valid username / password"),$location.path("/login")}),$rootScope.$on("event:loginConfirmed",function(){var i,requests=$rootScope.requests401,retry=function(req){$http(req.config).then(function(response){req.deferred.resolve(response)})};for(i=0;i<requests.length;i+=1)retry(requests[i]);$rootScope.requests401=[]}),$rootScope.$on("event:loginRequest",function(event,username,password){httpHeaders.common.Authorization="Basic "+Base64Service.encode(username+":"+password),$http.post("user/authenticate").success(function(){$rootScope.$broadcast("event:loginConfirmed"),delete $rootScope.error})}),$rootScope.$on("event:logoutRequest",function(){httpHeaders.common.Authorization=null,originalLocation="/main"})}),app.service("StudentService",function($http,$q){this.getStudents=function(){var d=$q.defer(),request={url:"student/ajax/list",dataType:"json",method:"GET",data:"",headers:{"Content-Type":"application/json"}};return $http(request).success(function(response){d.resolve(response)}),d.promise},this.deleteStudent=function(id){var d=$q.defer();return $http["delete"]("student/delete/"+id).success(function(response){d.resolve(response)}),d.promise},this.saveStudent=function(student){var d=$q.defer();return $http.post("student/save-ajax",student).success(function(response){d.resolve(response)}),d.promise}}),app.service("AuthenticationService",function($http,$q){this.logout=function(){var d=$q.defer();return $http.get("j_spring_security_logout").success(function(){d.resolve()}),d.promise}}),app.service("Base64Service",function(){var keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";this.encode=function(input){for(var chr1,chr2,enc1,enc2,enc3,output="",chr3="",enc4="",i=0;i<input.length;)chr1=input.charCodeAt(i++),chr2=input.charCodeAt(i++),chr3=input.charCodeAt(i++),enc1=chr1>>2,enc2=(3&chr1)<<4|chr2>>4,enc3=(15&chr2)<<2|chr3>>6,enc4=63&chr3,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output=output+keyStr.charAt(enc1)+keyStr.charAt(enc2)+keyStr.charAt(enc3)+keyStr.charAt(enc4),chr1=chr2=chr3="",enc1=enc2=enc3=enc4="";return output},this.decode=function(input){var chr1,chr2,enc1,enc2,enc3,output="",chr3="",enc4="",i=0;for(input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");i<input.length;)enc1=keyStr.indexOf(input.charAt(i++)),enc2=keyStr.indexOf(input.charAt(i++)),enc3=keyStr.indexOf(input.charAt(i++)),enc4=keyStr.indexOf(input.charAt(i++)),chr1=enc1<<2|enc2>>4,chr2=(15&enc2)<<4|enc3>>2,chr3=(3&enc3)<<6|enc4,output+=String.fromCharCode(chr1),64!=enc3&&(output+=String.fromCharCode(chr2)),64!=enc4&&(output+=String.fromCharCode(chr3)),chr1=chr2=chr3="",enc1=enc2=enc3=enc4=""}});